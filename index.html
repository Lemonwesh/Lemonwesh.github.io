<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lemons Proxy v7.0 - Global Leaderboards</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --blueprint-bg: #1e3a5f;
            --grid-line: rgba(255, 255, 255, 0.1);
            --text-primary: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.6);
            --accent: #4db8ff;
            --accent-gaming: #ff6b6b;
            --accent-study: #4ade80;
            --accent-warn: #ffd93d;
            --accent-arcade: #f472b6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--blueprint-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(to right, rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            pointer-events: none; z-index: 1;
        }

        .container { position: relative; z-index: 10; max-width: 1800px; margin: 0 auto; padding: 20px; }
        
        header {
            text-align: center; padding: 30px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            margin-bottom: 30px; background: rgba(30, 58, 95, 0.9);
        }

        .logo {
            font-size: 3.5rem; font-weight: bold; letter-spacing: 8px;
            text-transform: uppercase; margin-bottom: 10px;
            background: linear-gradient(45deg, var(--accent), var(--accent-study));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .live-indicator {
            display: inline-block; width: 10px; height: 10px;
            background: var(--accent-study); border-radius: 50%;
            margin-right: 8px; animation: pulse 1s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .user-status {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255,255,255,0.1); padding: 10px 20px;
            border: 1px solid rgba(255,255,255,0.3); font-size: 0.8rem;
        }

        .server-status {
            position: absolute; top: 20px; right: 20px;
            padding: 5px 15px; font-size: 0.75rem;
            text-transform: uppercase; letter-spacing: 2px;
        }
        .server-status.online { background: rgba(74, 222, 128, 0.2); border: 1px solid var(--accent-study); color: var(--accent-study); }
        .server-status.offline { background: rgba(255, 107, 107, 0.2); border: 1px solid var(--accent-gaming); color: var(--accent-gaming); }

        .nav-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        
        .tab-btn {
            background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.3);
            color: white; padding: 10px 20px; font-family: inherit;
            font-size: 0.85rem; cursor: pointer; text-transform: uppercase;
            letter-spacing: 2px; transition: all 0.3s;
        }
        .tab-btn:hover, .tab-btn.active { background: rgba(77, 184, 255, 0.2); border-color: var(--accent); transform: translateY(-2px); }
        .tab-btn.arcade { border-color: var(--accent-arcade); color: var(--accent-arcade); }
        .tab-btn.arcade:hover, .tab-btn.arcade.active { background: rgba(244, 114, 182, 0.2); }

        .content-section { display: none; animation: fadeIn 0.5s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        
        .game-tile {
            background: rgba(255,255,255,0.03); border: 2px solid rgba(244, 114, 182, 0.3);
            border-radius: 8px; overflow: hidden; transition: all 0.3s;
        }
        .game-tile:hover { transform: translateY(-5px); border-color: var(--accent-arcade); }
        
        .game-thumb { height: 120px; background: linear-gradient(135deg, #162d4a, #2a4a73); display: flex; align-items: center; justify-content: center; font-size: 3rem; }
        .game-info { padding: 15px; }
        .game-title { color: var(--accent-arcade); font-weight: bold; margin-bottom: 5px; }
        .play-btn { width: 100%; padding: 10px; background: var(--accent-arcade); border: none; color: white; cursor: pointer; text-transform: uppercase; font-weight: bold; }

        .game-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(22, 45, 74, 0.98); z-index: 1000; flex-direction: column;
        }
        .game-modal.active { display: flex; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: rgba(0,0,0,0.3); border-bottom: 2px solid var(--accent-arcade); }
        .close-btn { padding: 10px 20px; background: var(--accent-gaming); border: none; color: white; cursor: pointer; }
        
        .game-frame { width: 100%; height: 100%; border: none; }

        .leaderboard-box {
            background: rgba(0,0,0,0.2); border: 2px solid var(--accent-warn);
            padding: 20px; border-radius: 8px; margin-bottom: 20px;
        }
        .leaderboard-title { color: var(--accent-warn); text-align: center; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px dashed rgba(255,217,61,0.3); }
        
        .lb-item { display: flex; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.05); margin-bottom: 8px; border-radius: 4px; }
        .lb-rank { font-weight: bold; width: 40px; }
        .lb-rank.gold { color: gold; } .lb-rank.silver { color: silver; } .lb-rank.bronze { color: #cd7f32; }
        .lb-score { color: var(--accent-warn); font-weight: bold; }

        .account-panel { max-width: 500px; margin: 0 auto; background: rgba(255,255,255,0.03); border: 2px solid var(--accent-warn); padding: 30px; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--accent-warn); text-transform: uppercase; font-size: 0.8rem; }
        .input-group input { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,217,61,0.3); color: white; font-family: inherit; }
        .account-btn { width: 100%; padding: 15px; background: var(--accent-warn); border: none; color: var(--blueprint-bg); font-family: inherit; font-weight: bold; text-transform: uppercase; cursor: pointer; margin-bottom: 10px; }
        
        canvas { background: rgba(0,0,0,0.3); display: block; margin: 0 auto; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="user-status" id="user-status" onclick="showSection('account')">Guest - Click to Login</div>
            <div class="server-status offline" id="db-status">‚óè Connecting...</div>
            <div class="logo">üçã Lemons Proxy</div>
            <div style="color: var(--text-dim); letter-spacing: 5px;">Global Arcade v7.0</div>
            <div style="margin-top: 10px; color: var(--accent-study);">
                <span class="live-indicator"></span>Live Global Leaderboards Active
            </div>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn arcade active" onclick="switchTab('arcade')">üïπÔ∏è Arcade</button>
            <button class="tab-btn" onclick="switchTab('games')">üéÆ Games</button>
            <button class="tab-btn" onclick="switchTab('leaderboards')">üèÜ Global Records</button>
            <button class="tab-btn" onclick="switchTab('account')">üë§ Account</button>
        </div>

        <!-- ARCADE -->
        <div id="arcade-section" class="content-section active">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: var(--accent-arcade); text-transform: uppercase;">üéÆ Game Arcade</h2>
                <p style="color: var(--text-dim);">Play games instantly - scores save globally!</p>
            </div>
            <div class="games-grid" id="arcade-grid">
                <!-- Games populated by JS -->
            </div>
        </div>

        <!-- GAMES -->
        <div id="games-section" class="content-section">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2 style="color: var(--accent); text-transform: uppercase;">üïπÔ∏è Mini Games</h2>
                <p style="color: var(--text-dim);">Canvas-based unblockable games</p>
            </div>
            <div class="games-grid" id="games-grid"></div>
        </div>

        <!-- LEADERBOARDS -->
        <div id="leaderboards-section" class="content-section">
            <div class="leaderboard-box">
                <div class="leaderboard-title">üèÜ Global Champions</div>
                <div id="leaderboard-list">
                    <div class="lb-item">
                        <span class="lb-rank">-</span>
                        <span>Loading...</span>
                        <span class="lb-score">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACCOUNT -->
        <div id="account-section" class="content-section">
            <div id="login-panel" class="account-panel">
                <h2 style="color: var(--accent-warn); text-align: center; margin-bottom: 20px;">üë§ ACCOUNT ACCESS</h2>
                
                <div id="login-form">
                    <div class="input-group">
                        <label>Username</label>
                        <input type="text" id="login-user" placeholder="Enter username">
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="login-pass" placeholder="Password">
                    </div>
                    <button class="account-btn" onclick="login()">LOGIN</button>
                    <button class="account-btn" onclick="showRegister()" style="background: transparent; color: var(--accent-warn); border: 1px solid var(--accent-warn);">CREATE ACCOUNT</button>
                </div>
                
                <div id="register-form" class="hidden">
                    <div class="input-group">
                        <label>New Username</label>
                        <input type="text" id="reg-user" placeholder="3-15 characters">
                    </div>
                    <div class="input-group">
                        <label>Password</label>
                        <input type="password" id="reg-pass" placeholder="6+ characters">
                    </div>
                    <button class="account-btn" onclick="register()">CREATE ACCOUNT</button>
                    <button class="account-btn" onclick="showLogin()" style="background: transparent; color: var(--accent-warn); border: 1px solid var(--accent-warn);">BACK TO LOGIN</button>
                </div>
            </div>
            
            <div id="profile-panel" class="account-panel hidden">
                <h2 style="color: var(--accent-warn); text-align: center; margin-bottom: 20px;">üë§ PROFILE</h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="profile-name" style="font-size: 1.5rem; color: var(--accent);">Username</div>
                    <div id="profile-stats" style="color: var(--text-dim); margin-top: 10px;">Score: 0</div>
                </div>
                <button class="account-btn" onclick="logout()">LOGOUT</button>
            </div>
        </div>
    </div>

    <!-- GAME MODAL -->
    <div class="game-modal" id="game-modal">
        <div class="modal-header">
            <h3 id="modal-title" style="color: var(--accent-arcade); font-size: 1.5rem;">Game Title</h3>
            <div>
                <button class="close-btn" onclick="toggleFullscreen()">‚õ∂</button>
                <button class="close-btn" onclick="closeGame()">‚úï CLOSE</button>
            </div>
        </div>
        <iframe class="game-frame" id="game-frame" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
        <canvas id="game-canvas" width="800" height="600" style="display: none;"></canvas>
    </div>

    <!-- Firebase Integration -->
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBK-8DRAt1ir7-K8LgPsGtsv6x68-y96S4",
            authDomain: "lemonwesh-3d0fd.firebaseapp.com",
            projectId: "lemonwesh-3d0fd",
            storageBucket: "lemonwesh-3d0fd.firebasestorage.app",
            messagingSenderId: "127134752301",
            appId: "1:127134752301:web:72e2050bc0505ca2eea2a4"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // State
        let currentUser = null;
        let userData = null;
        let gameLoop = null;
        
        // Game Data
        const games = [
            { id: 'snake', name: 'Snake', icon: 'üêç', type: 'canvas' },
            { id: 'pong', name: 'Pong', icon: 'üèì', type: 'canvas' },
            { id: 'breakout', name: 'Breakout', icon: 'üß±', type: 'canvas' },
            { id: 'tetris', name: 'Tetris', icon: 'üì¶', type: 'canvas' },
            { id: 'flappy', name: 'Flappy', icon: 'üê¶', type: 'canvas' },
            { id: 'dino', name: 'Dino Run', icon: 'ü¶ñ', type: 'canvas' },
            { id: 'space', name: 'Space Invaders', icon: 'üëæ', type: 'canvas' },
            { id: 'clicker', name: 'Clicker', icon: 'üç™', type: 'canvas' }
        ];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderGames();
            
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    document.getElementById('db-status').textContent = '‚óè Online';
                    document.getElementById('db-status').className = 'server-status online';
                    
                    const doc = await db.collection('users').doc(user.uid).get();
                    if (doc.exists) userData = doc.data();
                    else {
                        userData = { username: user.displayName || 'User', totalScore: 0 };
                        await db.collection('users').doc(user.uid).set(userData);
                    }
                    updateUI();
                } else {
                    currentUser = null;
                    document.getElementById('db-status').textContent = '‚óè Offline';
                    document.getElementById('db-status').className = 'server-status offline';
                }
                loadLeaderboard();
            });
        });
        
        // Render Games
        function renderGames() {
            const html = games.map(g => `
                <div class="game-tile" onclick="playGame('${g.id}')">
                    <div class="game-thumb">${g.icon}</div>
                    <div class="game-info">
                        <div class="game-title">${g.name}</div>
                        <button class="play-btn">PLAY NOW</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('arcade-grid').innerHTML = html;
            document.getElementById('games-grid').innerHTML = html;
        }
        
        // Navigation
        function switchTab(tab) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab + '-section').classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'leaderboards') loadLeaderboard();
        }
        
        function showSection(section) {
            switchTab(section);
        }
        
        // Game System
        function playGame(id) {
            const modal = document.getElementById('game-modal');
            const frame = document.getElementById('game-frame');
            const canvas = document.getElementById('game-canvas');
            const title = document.getElementById('modal-title');
            
            modal.classList.add('active');
            title.textContent = games.find(g => g.id === id).name;
            
            if (games.find(g => g.id === id).type === 'canvas') {
                frame.style.display = 'none';
                canvas.style.display = 'block';
                initCanvasGame(id);
            } else {
                canvas.style.display = 'none';
                frame.style.display = 'block';
                frame.src = games.find(g => g.id === id).url;
            }
        }
        
        function closeGame() {
            document.getElementById('game-modal').classList.remove('active');
            document.getElementById('game-frame').src = '';
            if (gameLoop) clearInterval(gameLoop);
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }
        
        // Canvas Games (Working)
        function initCanvasGame(id) {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            
            if (gameLoop) clearInterval(gameLoop);
            
            switch(id) {
                case 'snake':
                    let snake = [{x:10,y:10}], food = {x:15,y:15}, dx=1, dy=0, score=0;
                    gameLoop = setInterval(() => {
                        const head = {x:snake[0].x+dx,y:snake[0].y+dy};
                        if (head.x<0||head.x>=40||head.y<0||head.y>=30||snake.some(s=>s.x===head.x&&s.y===head.y)) {
                            clearInterval(gameLoop);
                            saveScore('snake', score);
                            return;
                        }
                        snake.unshift(head);
                        if (head.x===food.x&&head.y===food.y) { score+=10; food={x:Math.floor(Math.random()*40),y:Math.floor(Math.random()*30)}; }
                        else snake.pop();
                        
                        ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
                        ctx.fillStyle='#0f0';snake.forEach(s=>ctx.fillRect(s.x*20,s.y*20,18,18));
                        ctx.fillStyle='#f00';ctx.fillRect(food.x*20,food.y*20,18,18);
                        ctx.fillStyle='#fff';ctx.fillText('Score:'+score,10,30);
                    }, 100);
                    document.onkeydown=(e)=>{
                        if (e.key==='ArrowUp'&&dy===0){dx=0;dy=-1;}
                        if (e.key==='ArrowDown'&&dy===0){dx=0;dy=1;}
                        if (e.key==='ArrowLeft'&&dx===0){dx=-1;dy=0;}
                        if (e.key==='ArrowRight'&&dx===0){dx=1;dy=0;}
                    };
                    break;
                
                case 'pong':
                    let py=250,by=300,bx=400,bdx=-5,bdy=5,pscore=0;
                    document.onmousemove=(e)=>{
                        const rect=canvas.getBoundingClientRect();
                        py=e.clientY-rect.top-50;
                    };
                    gameLoop=setInterval(()=>{
                        bx+=bdx;by+=bdy;
                        if(by<=0||by>=590)bdy*=-1;
                        if(bx<=20&&by>py&&by<py+100){bdx*=-1;pscore++;}
                        if(bx>=800)bdx*=-1;
                        if(bx<0){clearInterval(gameLoop);saveScore('pong',pscore);return;}
                        ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
                        ctx.fillStyle='#fff';ctx.fillRect(10,py,10,100);ctx.fillRect(780,by-50,10,100);ctx.fillRect(bx,by,10,10);
                        ctx.font='30px monospace';ctx.fillText(pscore,400,50);
                    },16);
                    break;
                
                case 'breakout':
                    let px=350,bricks=[],bx2=400,by2=300,bdx2=4,bdy2=-4,bscore=0;
                    for(let i=0;i<5;i++)for(let j=0;j<8;j++)bricks.push({x:j*95+10,y:i*30+50,active:true});
                    document.onmousemove=(e)=>{
                        const rect=canvas.getBoundingClientRect();
                        px=e.clientX-rect.left-50;
                    };
                    gameLoop=setInterval(()=>{
                        bx2+=bdx2;by2+=bdy2;
                        if(bx2<=0||bx2>=790)bdx2*=-1;
                        if(by2<=0)bdy2*=-1;
                        if(by2>=570&&bx2>px&&bx2<px+100)bdy2*=-1;
                        if(by2>600){clearInterval(gameLoop);saveScore('breakout',bscore);return;}
                        bricks.forEach(b=>{if(b.active&&bx2>b.x&&bx2<b.x+85&&by2>b.y&&by2<b.y+20){b.active=false;bdy2*=-1;bscore+=10;}});
                        ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
                        ctx.fillStyle='#0f0';ctx.fillRect(px,580,100,10);
                        ctx.fillStyle='#fff';ctx.fillRect(bx2,by2,10,10);
                        ctx.fillStyle='#00f';bricks.forEach(b=>{if(b.active)ctx.fillRect(b.x,b.y,85,20);});
                        ctx.fillStyle='#fff';ctx.fillText('Score:'+bscore,10,30);
                    },16);
                    break;
                
                default:
                    ctx.fillStyle='#000';ctx.fillRect(0,0,800,600);
                    ctx.fillStyle='#fff';ctx.font='30px monospace';
                    ctx.fillText(id+' - Click PLAY',300,300);
            }
        }
        
        // Auth
        async function login() {
            const user = document.getElementById('login-user').value;
            const pass = document.getElementById('login-pass').value;
            try {
                await auth.signInWithEmailAndPassword(user+'@lemons.proxy', pass);
            } catch (err) {
                alert('Login failed');
            }
        }
        
        async function register() {
            const user = document.getElementById('reg-user').value;
            const pass = document.getElementById('reg-pass').value;
            if (user.length<3) return alert('Username too short');
            try {
                const cred = await auth.createUserWithEmailAndPassword(user+'@lemons.proxy', pass);
                await cred.user.updateProfile({displayName:user});
                await db.collection('users').doc(cred.user.uid).set({username:user,totalScore:0});
            } catch (err) {
                alert('Error: '+err.message);
            }
        }
        
        function logout() {
            auth.signOut();
        }
        
        function showRegister() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }
        
        function showLogin() {
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }
        
        function updateUI() {
            document.getElementById('user-status').textContent = userData.username;
            document.getElementById('login-panel').classList.add('hidden');
            document.getElementById('profile-panel').classList.remove('hidden');
            document.getElementById('profile-name').textContent = userData.username;
            document.getElementById('profile-stats').textContent = 'Total Score: '+(userData.totalScore||0);
        }
        
        // Leaderboard
        async function loadLeaderboard() {
            const snap = await db.collection('scores').orderBy('score','desc').limit(10).get();
            let html = '';
            let rank = 1;
            snap.forEach(doc => {
                const s = doc.data();
                html += `<div class="lb-item"><span class="lb-rank ${rank<=3?['gold','silver','bronze'][rank-1]:''}">#${rank}</span><span>${s.username}</span><span class="lb-score">${s.score}</span></div>`;
                rank++;
            });
            document.getElementById('leaderboard-list').innerHTML = html || '<div class="lb-item"><span>No scores yet</span></div>';
        }
        
        async function saveScore(game,score) {
            if(!currentUser)return;
            await db.collection('scores').add({
                userId:currentUser.uid,
                username:userData.username,
                game:game,
                score:score,
                timestamp:Date.now()
            });
            const newTotal = (userData.totalScore||0)+score;
            await db.collection('users').doc(currentUser.uid).update({totalScore:newTotal});
            userData.totalScore = newTotal;
            setTimeout(()=>alert('Score saved: '+score),100);
        }
    </script>
</body>
</html>
