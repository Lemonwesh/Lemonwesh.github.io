            <input type="text" class="search-input" id="gameSearch" placeholder="Search protocols... [Try 'lemon' or 'aurelio']" autocomplete="off">
        </div>

        <div class="games-grid" id="gamesGrid">
            <!-- Games populated by JS -->
        </div>
    </section>

    <section id="proxy" class="section">
        <div class="coming-soon">
            <div class="hack-map">
                <div class="map-grid"></div>
                <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
                    <div style="font-size:2rem;margin-bottom:10px;">üåê</div>
                    <div style="color:var(--terminal-blue);font-family:'JetBrains Mono';">SECURE_PROXY_NODE</div>
                </div>
            </div>
            <h2 class="coming-title">PROXY_TERMINAL</h2>
            <p class="coming-subtitle">BYPASS RESTRICTIONS // ACCESS FREELY</p>
            <p class="coming-text">
                Enter URL below to route through encrypted proxy servers.
                Connection is tunneled through secure nodes.
            </p>
            <div style="max-width:600px;margin:0 auto;display:flex;gap:10px;">
                <input type="text" id="proxyUrl" placeholder="https://example.com" style="flex:1;padding:12px;background:var(--bg-primary);border:1px solid rgba(59,130,246,0.3);color:var(--text-primary);border-radius:4px;font-family:'JetBrains Mono';">
                <button class="control-btn" onclick="loadProxy()">CONNECT</button>
            </div>
            <div id="proxyFrame" style="margin-top:20px;width:100%;height:500px;background:var(--bg-primary);border:1px solid rgba(59,130,246,0.3);border-radius:4px;display:none;">
                <iframe id="proxyIframe" style="width:100%;height:100%;border:none;"></iframe>
            </div>
        </div>
    </section>

    <section id="tools" class="section">
        <div class="games-grid">
            <div class="game-module" onclick="openTool('calc')">
                <div class="module-header">
                    <span class="module-icon">üßÆ</span>
                    <span class="module-tag">UTIL</span>
                </div>
                <div class="module-title">Calculator</div>
                <div class="module-meta">v1.0 // Basic Math</div>
            </div>
            <div class="game-module" onclick="openTool('notes')">
                <div class="module-header">
                    <span class="module-icon">üìù</span>
                    <span class="module-tag">UTIL</span>
                </div>
                <div class="module-title">Secure Notes</div>
                <div class="module-meta">Encrypted // Local</div>
            </div>
            <div class="game-module" onclick="openTool('clock')">
                <div class="module-header">
                    <span class="module-icon">‚è∞</span>
                    <span class="module-tag">UTIL</span>
                </div>
                <div class="module-title">World Clock</div>
                <div class="module-meta">Multi-Timezone</div>
            </div>
            <div class="game-module" onclick="openTool('convert')">
                <div class="module-header">
                    <span class="module-icon">üîÑ</span>
                    <span class="module-tag">UTIL</span>
                </div>
                <div class="module-title">Converter</div>
                <div class="module-meta">Units // Currency</div>
            </div>
        </div>
    </section>

    <section id="about" class="section">
        <div class="coming-soon" style="max-width:800px;margin:0 auto;">
            <h2 class="coming-title">SYSTEM_INFO</h2>
            <div style="text-align:left;padding:20px;font-family:'JetBrains Mono';font-size:0.9rem;line-height:1.8;">
                <div style="color:var(--terminal-blue);margin-bottom:15px;">// LEMONS_PROXY v10.0 BLUEPRINT EDITION</div>
                <div style="color:var(--text-secondary);margin-bottom:10px;">> Developed by: <span style="color:var(--terminal-bright);">lemonwesh</span> & <span style="color:var(--terminal-bright);">LD</span></div>
                <div style="color:var(--text-secondary);margin-bottom:10px;">> Architecture: <span style="color:var(--terminal-bright);">Static HTML5/ES6+</span></div>
                <div style="color:var(--text-secondary);margin-bottom:10px;">> Security: <span style="color:var(--terminal-bright);">Client-Side Only</span></div>
                <div style="color:var(--text-secondary);margin-bottom:20px;">> License: <span style="color:var(--terminal-bright);">Open Source // MIT</span></div>
                
                <div style="color:var(--terminal-amber);margin-bottom:10px;">// HIDDEN COMMANDS</div>
                <div style="color:var(--text-secondary);font-size:0.8rem;line-height:2;">
                    <div>‚Ä¢ Search "lemon" 5x ‚Üí Unlock Secret Menu</div>
                    <div>‚Ä¢ Search "aurelio" 5x ‚Üí Trigger Lockdown</div>
                    <div>‚Ä¢ Click logo rapidly ‚Üí Surprise</div>
                    <div>‚Ä¢ Konami Code ‚Üí Classic</div>
                    <div>‚Ä¢ Type "idkfa" ‚Üí God Mode</div>
                    <div>‚Ä¢ Ctrl+Shift+L ‚Üí LemonÊç∑ÂæÑ</div>
                </div>
            </div>
        </div>
    </section>
</div>

<div class="game-viewer" id="gameViewer">
    <div class="viewer-header">
        <div class="viewer-title" id="viewerTitle">> GAME_LOADED</div>
        <div class="controls-group">
            <button class="control-btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
            <button class="control-btn" onclick="reloadGame()">‚Üª Reload</button>
            <button class="control-btn close" onclick="closeGame()">‚úï Close</button>
        </div>
    </div>
    <iframe id="gameFrame" allowfullscreen></iframe>
</div>

<div class="music-player">
    <span class="music-label">Audio_Cache:</span>
    <input type="text" class="music-input" id="musicUrl" placeholder="Enter audio URL or YouTube ID...">
    <button class="music-btn" onclick="playMusic()">‚ñ∂ Play</button>
    <button class="music-btn" onclick="stopMusic()" style="background:transparent;border-color:var(--error-red);color:var(--error-red);">‚èπ Stop</button>
    <span class="now-playing" id="nowPlaying"></span>
</div>

<button class="achievements-btn" onclick="toggleAchievements()" title="Achievements">üèÜ</button>
<div class="achievements-panel" id="achievementsPanel">
    <div class="panel-header">
        <span>ACHIEVEMENTS</span>
        <span id="achievementCount" style="color:var(--text-secondary);font-size:0.75rem;">0/12</span>
    </div>
    <div id="achievementsList">
        <!-- Populated by JS -->
    </div>
</div>

<div class="achievement-popup" id="achievementPopup">
    <div class="pop-icon" id="popIcon">üèÜ</div>
    <div class="pop-text">
        <h3 id="popTitle">Achievement Unlocked!</h3>
        <p id="popDesc">Description here</p>
    </div>
</div>

<div class="easter-egg-toast" id="easterToast"></div>
<div class="console-toast" id="consoleToast"></div>
<div class="debug-overlay" id="debugOverlay">
    <div class="debug-info">
        <div>DEBUG_MODE: ACTIVE</div>
        <div>FPS: <span id="fps">60</span></div>
        <div>Memory: <span id="memory">--</span></div>
        <div>Search Count: <span id="debugSearch">0</span></div>
        <div>Aurelio Level: <span id="debugAurelio">0</span></div>
        <div>Lemon Count: <span id="debugLemon">0</span></div>
        <div>Konami: <span id="debugKonami">false</span></div>
    </div>
</div>

<div class="status-bar">
    <div class="status-left">
        <span id="statusText">System Ready</span>
        <span style="color:var(--terminal-blue);">‚óè</span>
        <span>Session: <span id="sessionTime">00:00:00</span></span>
    </div>
    <div>
        <span style="color:var(--terminal-dim);">v10.0.2-beta</span>
        <span style="margin-left:15px;color:var(--success-green);">‚óè Secure</span>
    </div>
</div>

<script>
// ===== STATE MANAGEMENT =====
const state = {
    booted: false,
    achievements: [],
    games: [],
    easterEggs: {
        lemon: 0,
        aurelio: 0,
        logoClicks: 0,
        konami: false,
        secretUnlocked: false,
        godMode: false,
        nightMode: false,
        debug: false,
        speedRun: false
    },
    sessionStart: Date.now(),
    matrixIntensity: 0.08,
    audioPlayer: null,
    shutdownTimer: null,
    shutdownActive: false
};

// ===== ACHIEVEMENTS DATABASE =====
const achievementsDB = [
    {id: 'first_boot', name: 'First Boot', desc: 'Initialize the system', icon: 'üñ•Ô∏è', unlocked: false},
    {id: 'lemon_hunter', name: 'Lemon Hunter', desc: 'Search for lemons 5 times', icon: 'üçã', unlocked: false},
    {id: 'aurelio_victim', name: 'Aurelio\'s Wrath', desc: 'Trigger the shutdown sequence', icon: 'üõë', unlocked: false},
    {id: 'konami_master', name: 'Konami Code', desc: 'Enter the legendary code', icon: '‚¨ÜÔ∏è', unlocked: false},
    {id: 'logo_spammer', name: 'Logo Clicker', desc: 'Click the logo 10 times', icon: 'üñ±Ô∏è', unlocked: false},
    {id: 'secret_agent', name: 'Secret Agent', desc: 'Unlock the Secret Menu', icon: 'üîê', unlocked: false},
    {id: 'god_mode', name: 'God Mode', desc: 'Activate god mode', icon: 'üëë', unlocked: false},
    {id: 'night_owl', name: 'Night Owl', desc: 'Enable night mode', icon: 'üåô', unlocked: false},
    {id: 'speed_demon', name: 'Speed Demon', desc: 'Enable speed run mode', icon: '‚ö°', unlocked: false},
    {id: 'hacker', name: '1337 H4x0r', desc: 'Enable debug overlay', icon: 'üíª', unlocked: false},
    {id: 'survivor', name: 'Survivor', desc: 'Survive Aurelio\'s lockdown', icon: '‚è±Ô∏è', unlocked: false},
    {id: 'music_lover', name: 'DJ Lemon', desc: 'Play custom audio', icon: 'üéµ', unlocked: false}
];

// ===== BOOT SEQUENCE =====
const bootLines = [
    {text: 'Initializing LEMONS_PROXY v10.0...', type: 'normal', delay: 100},
    {text: 'Loading blueprint protocols...', type: 'normal', delay: 200},
    {text: 'Connecting to secure nodes...', type: 'normal', delay: 300},
    {text: 'Establishing encrypted tunnel...', type: 'normal', delay: 400},
    {text: 'WARNING: Aurelio protection active', type: 'warn', delay: 600},
    {text: 'Mounting virtual file systems...', type: 'normal', delay: 800},
    {text: 'Loading game modules [400+]...', type: 'normal', delay: 1000},
    {text: 'Compiling easter eggs...', type: 'normal', delay: 1200},
    {text: 'Search "lemon" for secrets', type: 'dim', delay: 1400},
    {text: 'System ready.', type: 'success', delay: 1600}
];

function initBoot() {
    const container = document.getElementById('boot-content');
    bootLines.forEach((line, i) => {
        setTimeout(() => {
            const div = document.createElement('div');
            div.className = `boot-line ${line.type}`;
            div.textContent = `> ${line.text}`;
            container.appendChild(div);
        }, line.delay);
    });
    
    setTimeout(() => {
        if (!state.booted) skipBoot();
    }, 3500);
}

function skipBoot() {
    state.booted = true;
    document.getElementById('boot-sequence').style.display = 'none';
    unlockAchievement('first_boot');
    initSystems();
}

// ===== MATRIX BACKGROUND =====
function initMatrix() {
    const canvas = document.getElementById('matrix-canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥';
    const drops = [];
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    
    for (let i = 0; i < columns; i++) drops[i] = 1;
    
    function draw() {
        if (state.easterEggs.speedRun) {
            ctx.fillStyle = 'rgba(10, 22, 40, 0.3)';
        } else {
            ctx.fillStyle = `rgba(10, 22, 40, ${1 - state.matrixIntensity * 10})`;
        }
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = '#3b82f6';
        ctx.font = fontSize + 'px monospace';
        
        for (let i = 0; i < drops.length; i++) {
            const text = chars[Math.floor(Math.random() * chars.length)];
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                drops[i] = 0;
            }
            drops[i] += state.easterEggs.speedRun ? 3 : 1;
        }
    }
    
    setInterval(draw, state.easterEggs.speedRun ? 16 : 33);
}

// ===== GAMES DATABASE =====
const games = [
    {id: 1, name: "2048", icon: "üî¢", tag: "PUZZLE", url: "https://games.lemonwesh.com/2048"},
    {id: 2, name: "Slope", icon: "‚õ∑Ô∏è", tag: "ACTION", url: "https://games.lemonwesh.com/slope"},
    {id: 3, name: "Tetris", icon: "üß±", tag: "CLASSIC", url: "https://games.lemonwesh.com/tetris"},
    {id: 4, name: "Snake", icon: "üêç", tag: "CLASSIC", url: "https://games.lemonwesh.com/snake"},
    {id: 5, name: "Chess", icon: "‚ôüÔ∏è", tag: "STRATEGY", url: "https://games.lemonwesh.com/chess"},
    {id: 6, name: "Pacman", icon: "üëª", tag: "ARCADE", url: "https://games.lemonwesh.com/pacman"},
    {id: 7, name: "Space Invaders", icon: "üëæ", tag: "ARCADE", url: "https://games.lemonwesh.com/space-invaders"},
    {id: 8, name: "Flappy Bird", icon: "üê¶", tag: "CASUAL", url: "https://games.lemonwesh.com/flappy"},
    {id: 9, name: "Minesweeper", icon: "üí£", tag: "PUZZLE", url: "https://games.lemonwesh.com/minesweeper"},
    {id: 10, name: "Solitaire", icon: "üÉè", tag: "CARD", url: "https://games.lemonwesh.com/solitaire"},
    {id: 11, name: "Pong", icon: "üèì", tag: "CLASSIC", url: "https://games.lemonwesh.com/pong"},
    {id: 12, name: "Breakout", icon: "üß±", tag: "ARCADE", url: "https://games.lemonwesh.com/breakout"}
];

function initGames() {
    const grid = document.getElementById('gamesGrid');
    document.getElementById('gameCount').textContent = games.length;
    
    games.forEach(game => {
        const module = document.createElement('div');
        module.className = 'game-module';
        module.innerHTML = `
            <div class="module-header">
                <span class="module-icon">${game.icon}</span>
                <span class="module-tag">${game.tag}</span>
            </div>
            <div class="module-title">${game.name}</div>
            <div class="module-meta">
                <span>v1.0</span>
                <span>></span>
            </div>
        `;
        module.onclick = () => openGame(game);
        grid.appendChild(module);
    });
}

// ===== SEARCH SYSTEM WITH EASTER EGGS =====
let searchDebounce;
document.getElementById('gameSearch')?.addEventListener('input', function(e) {
    clearTimeout(searchDebounce);
    searchDebounce = setTimeout(() => handleSearch(e.target.value.toLowerCase()), 500);
});

function handleSearch(term) {
    if (state.shutdownActive) return;
    
    // Aurelio Detection System
    if (term.includes('aurelio')) {
        state.easterEggs.aurelio++;
        document.getElementById('debugAurelio').textContent = state.easterEggs.aurelio;
        
        const messages = [
            "Aurelio is watching...",
            "STOP searching for that.",
            "This is your final warning.",
            "You have angered Aurelio.",
            "SYSTEM LOCKDOWN INITIATED"
        ];
        
        if (state.easterEggs.aurelio <= 5) {
            showToast(messages[state.easterEggs.aurelio - 1], state.easterEggs.aurelio >= 4 ? 'furious' : state.easterEggs.aurelio >= 3 ? 'angry' : 'normal');
        }
        
        if (state.easterEggs.aurelio === 5) {
            triggerShutdown();
            unlockAchievement('aurelio_victim');
        }
        return;
    }
    
    // Lemon Protocol
    if (term.includes('lemon')) {
        state.easterEggs.lemon++;
        document.getElementById('debugLemon').textContent = state.easterEggs.lemon;
        
        const lemonMsgs = [
            "üçã Detected...",
            "Lemon concentration increasing...",
            "Citrus levels critical...",
            "Sour protocols engaging...",
            "üçã LEMON PROTOCOL UNLOCKED üçã"
        ];
        
        showToast(lemonMsgs[state.easterEggs.lemon - 1], 'unlocked');
        
        if (state.easterEggs.lemon === 5 && !state.easterEggs.secretUnlocked) {
            unlockSecretMenu();
            unlockAchievement('lemon_hunter');
            unlockAchievement('secret_agent');
        }
        return;
    }
    
    // God Mode Code
    if (term === 'idkfa') {
        toggleGodMode();
        document.getElementById('gameSearch').value = '';
        return;
    }
    
    // Normal search
    const modules = document.querySelectorAll('.game-module');
    modules.forEach(mod => {
        const text = mod.textContent.toLowerCase();
        mod.style.display = text.includes(term) ? 'block' : 'none';
    });
    
    document.getElementById('debugSearch').textContent = term;
}

function unlockSecretMenu() {
    state.easterEggs.secretUnlocked = true;
    document.getElementById('secretMenu').classList.add('active');
    showToast('SECRET MENU UNLOCKED\nCheck Home page!', 'unlocked');
}

// ===== SHUTDOWN/AURELIO SYSTEM =====
function triggerShutdown() {
    state.shutdownActive = true;
    const overlay = document.getElementById('shutdown-overlay');
    const timer = document.querySelector('.shutdown-timer');
    overlay.classList.add('active');
    
    let timeLeft = 60;
    state.shutdownTimer = setInterval(() => {
        timeLeft--;
        timer.textContent = timeLeft;
        if (timeLeft <= 0) {
            endShutdown();
            unlockAchievement('survivor');
        }
    }, 1000);
    
    // Secret escape hatch - type 'sorry'
    let buffer = '';
    document.addEventListener('keydown', function escapeHandler(e) {
        if (!state.shutdownActive) {
            document.removeEventListener('keydown', escapeHandler);
            return;
        }
        buffer += e.key.toLowerCase();
        if (buffer.includes('sorry')) {
            endShutdown();
            document.removeEventListener('keydown', escapeHandler);
        }
        if (buffer.length > 10) buffer = buffer.slice(-10);
    });
}

function endShutdown() {
    state.shutdownActive = false;
    clearInterval(state.shutdownTimer);
    document.getElementById('shutdown-overlay').classList.remove('active');
    state.easterEggs.aurelio = 0;
    document.getElementById('debugAurelio').textContent = '0';
    showToast('Lockdown ended. Behave yourself.', 'normal');
}

// ===== SECRET MENU FUNCTIONS =====
function toggleMatrix() {
    const canvas = document.getElementById('matrix-canvas');
    canvas.style.opacity = canvas.style.opacity === '0' ? state.matrixIntensity : '0';
    updateSecretStatus('Matrix toggled');
}

function setMatrixIntensity(val) {
    state.matrixIntensity = val / 100;
    document.getElementById('matrixValue').textContent = val + '%';
    document.getElementById('matrix-canvas').style.opacity = state.matrixIntensity;
}

function toggleNightMode() {
    state.easterEggs.nightMode = !state.easterEggs.nightMode;
    document.body.classList.toggle('night-mode');
    updateSecretStatus('Night Mode: ' + (state.easterEggs.nightMode ? 'ON' : 'OFF'));
    unlockAchievement('night_owl');
}

function toggleGodMode() {
    state.easterEggs.godMode = !state.easterEggs.godMode;
    document.body.classList.toggle('god-mode');
    updateSecretStatus('GOD MODE: ' + (state.easterEggs.godMode ? 'ACTIVE' : 'INACTIVE'));
    unlockAchievement('god_mode');
}

function toggleDebug() {
    state.easterEggs.debug = !state.easterEggs.debug;
    document.getElementById('debugOverlay').classList.toggle('active');
    document.getElementById('debugKonami').textContent = state.easterEggs.konami;
    updateSecretStatus('Debug Overlay: ' + (state.easterEggs.debug ? 'ON' : 'OFF'));
    unlockAchievement('hacker');
}

function speedRunMode() {
    state.easterEggs.speedRun = !state.easterEggs.speedRun;
    document.body.classList.toggle('speed-mode');
    updateSecretStatus('SPEED RUN: ' + (state.easterEggs.speedRun ? 'ENGAGED' : 'NORMAL'));
    unlockAchievement('speed_demon');
}

function fakeDelete() {
    updateSecretStatus('DELETING SYSTEM32...');
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
            progress = 100;
            clearInterval(interval);
            updateSecretStatus('SYSTEM32 DELETED... jk lol');
            setTimeout(() => updateSecretStatus('PROTOCOL ACTIVE'), 2000);
        } else {
            updateSecretStatus(`DELETING... ${Math.floor(progress)}%`);
        }
    }, 200);
}

function fakeIPLog() {
    const fakeIPs = ['192.168.1.105', '10.0.0.42', '172.16.0.7', '127.0.0.1'];
    const ip = fakeIPs[Math.floor(Math.random() * fakeIPs.length)];
    updateSecretStatus(`Logged IP: ${ip}\nLocation: Your Mom\'s House`);
    setTimeout(() => updateSecretStatus('Just kidding. Privacy respected.'), 3000);
}

function unlockAllAchievements() {
    achievementsDB.forEach(ach => {
        if (!ach.unlocked) unlockAchievement(ach.id);
    });
    updateSecretStatus('All achievements unlocked');
}

function updateSecretStatus(msg) {
    document.getElementById('secretStatus').textContent = msg;
}

// ===== KONAMI CODE =====
let konamiBuffer = [];
const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

document.addEventListener('keydown', (e) => {
    konamiBuffer.push(e.key);
    if (konamiBuffer.length > 10) konamiBuffer.shift();
    
    if (konamiBuffer.join(',') === konamiCode.join(',')) {
        state.easterEggs.konami = true;
        document.getElementById('debugKonami').textContent = 'true';
        unlockAchievement('konami_master');
        showToast('Konami Code Activated!\n30 Lives? Nope, just respect.', 'unlocked');
        document.body.style.filter = 'hue-rotate(90deg)';
        setTimeout(() => document.body.style.filter = '', 1000);
    }
    
    // Ctrl+Shift+L shortcut
    if (e.ctrlKey && e.shiftKey && e.key === 'L') {
        e.preventDefault();
        document.getElementById('gameSearch')?.focus();
        document.getElementById('gameSearch').value = 'lemon';
        handleSearch('lemon');
    }
});

// ===== LOGO EASTER EGG =====
function logoClick() {
    state.easterEggs.logoClicks++;
    if (state.easterEggs.logoClicks === 10) {
        unlockAchievement('logo_spammer');
        showToast('Logo clicked 10 times!\nYou must really like lemons.', 'unlocked');
    }
    
    if (state.easterEggs.logoClicks % 5 === 0) {
        const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff'];
        document.documentElement.style.setProperty('--terminal-blue', colors[Math.floor(Math.random() * colors.length)]);
        setTimeout(() => {
            document.documentElement.style.setProperty('--terminal-blue', '#3b82f6');
        }, 500);
    }
}

// ===== ACHIEVEMENT SYSTEM =====
function initAchievements() {
    const container = document.getElementById('achievementsList');
    container.innerHTML = '';
    
    achievementsDB.forEach(ach => {
        const item = document.createElement('div');
        item.className = 'achievement-item' + (ach.unlocked ? ' unlocked' : '');
        item.innerHTML = `
            <div class="achievement-icon">${ach.unlocked ? ach.icon : 'üîí'}</div>
            <div class="achievement-info">
                <h4>${ach.name}</h4>
                <p>${ach.desc}</p>
            </div>
        `;
        container.appendChild(item);
    });
    
    const unlocked = achievementsDB.filter(a => a.unlocked).length;
    document.getElementById('achievementCount').textContent = `${unlocked}/${achievementsDB.length}`;
}

function unlockAchievement(id) {
    const ach = achievementsDB.find(a => a.id === id);
    if (ach && !ach.unlocked) {
        ach.unlocked = true;
        initAchievements();
        showAchievementPopup(ach);
        saveState();
    }
}

function showAchievementPopup(ach) {
    const popup = document.getElementById('achievementPopup');
    document.getElementById('popIcon').textContent = ach.icon;
    document.getElementById('popTitle').textContent = 'Achievement Unlocked!';
    document.getElementById('popDesc').textContent = ach.name;
    
    popup.classList.add('show');
    setTimeout(() => popup.classList.remove('show'), 3000);
}

function toggleAchievements() {
    document.getElementById('achievementsPanel').classList.toggle('active');
}

// ===== UTILITY FUNCTIONS =====
function showSection(section) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(section)?.classList.add('active');
    event.target.classList.add('active');
    document.getElementById('statusText').textContent = `Viewing: ${section.toUpperCase()}`;
}

function showToast(message, type = 'normal') {
    const toast = document.getElementById('easterToast');
    toast.textContent = message;
    toast.className = 'easter-egg-toast show ' + type;
    setTimeout(() => toast.classList.remove('show'), 3000);
}

function openGame(game) {
    document.getElementById('viewerTitle').innerHTML = `> ${game.name.toUpperCase()} // ${game.tag}`;
    document.getElementById('gameFrame').src = game.url;
    document.getElementById('gameViewer').classList.add('active');
    document.getElementById('statusText').textContent = `Playing: ${game.name}`;
}

function closeGame() {
    document.getElementById('gameViewer').classList.remove('active');
    document.getElementById('gameFrame').src = '';
    document.getElementById('statusText').textContent = 'System Ready';
}

function reloadGame() {
    document.getElementById('gameFrame').src = document.getElementById('gameFrame').src;
}

function toggleFullscreen() {
    const frame = document.getElementById('gameFrame');
    if (frame.requestFullscreen) frame.requestFullscreen();
}

function loadProxy() {
    const url = document.getElementById('proxyUrl').value;
    if (url) {
        document.getElementById('proxyFrame').style.display = 'block';
        document.getElementById('proxyIframe').src = url;
    }
}

function playMusic() {
    const url = document.getElementById('musicUrl').value;
    if (url) {
        if (state.audioPlayer) state.audioPlayer.pause();
        state.audioPlayer = new Audio(url);
        state.audioPlayer.play();
        document.getElementById('nowPlaying').textContent = '‚ñ∂ Playing...';
        document.getElementById('nowPlaying').classList.add('active');
        unlockAchievement('music_lover');
    }
}

function stopMusic() {
    if (state.audioPlayer) {
        state.audioPlayer.pause();
        document.getElementById('nowPlaying').classList.remove('active');
    }
}

function dismissDevWarning() {
    document.getElementById('devWarning').style.display = 'none';
}

function toggleCloak() {
    const titles = ['Google', 'Classroom', 'Canvas', 'Home', 'Dashboard'];
    const icons = [
        'https://www.google.com/favicon.ico',
        'https://ssl.gstatic.com/classroom/favicon.png',
        'https://instructure.com/favicon.ico'
    ];
    const rand = Math.floor(Math.random() * titles.length);
    document.title = titles[rand];
    document.getElementById('favicon').href = icons[Math.floor(Math.random() * icons.length)];
    showToast('Tab cloaked as: ' + titles[rand], 'normal');
}

function openTool(tool) {
    showToast(`Opening ${tool}... (Demo only)`, 'normal');
}

// ===== SESSION TIMER =====
setInterval(() => {
    const elapsed = Math.floor((Date.now() - state.sessionStart) / 1000);
    const hours = Math.floor(elapsed / 3600).toString().padStart(2, '0');
    const mins = Math.floor((elapsed % 3600) / 60).toString().padStart(2, '0');
    const secs = (elapsed % 60).toString().padStart(2, '0');
    document.getElementById('sessionTime').textContent = `${hours}:${mins}:${secs}`;
    
    // Random latency fluctuation
    if (Math.random() > 0.7) {
        document.getElementById('latency').textContent = Math.floor(Math.random() * 20 + 5) + 'ms';
    }
    
    // Update debug info
    if (state.easterEggs.debug) {
        document.getElementById('fps').textContent = Math.floor(Math.random() * 10 + 55);
        document.getElementById('memory').textContent = (Math.random() * 100 + 200).toFixed(1) + 'MB';
    }
}, 1000);

// ===== CLOCK =====
setInterval(() => {
    const now = new Date();
    document.getElementById('clock').textContent = now.toLocaleTimeString('en-US', {hour12: false});
}, 1000);

// ===== SAVE/LOAD STATE =====
function saveState() {
    localStorage.setItem('lemons_proxy_state', JSON.stringify({
        achievements: achievementsDB.map(a => ({id: a.id, unlocked: a.unlocked})),
        easterEggs: state.easterEggs
    }));
}

function loadState() {
    const saved = localStorage.getItem('lemons_proxy_state');
    if (saved) {
        const data = JSON.parse(saved);
        data.achievements.forEach(savedAch => {
            const ach = achievementsDB.find(a => a.id === savedAch.id);
            if (ach) ach.unlocked = savedAch.unlocked;
        });
        Object.assign(state.easterEggs, data.easterEggs);
        
        if (state.easterEggs.secretUnlocked) {
            document.getElementById('secretMenu').classList.add('active');
        }
    }
}

// ===== CONSOLE EASTER EGG =====
console.log('%cüçã LEMONS_PROXY v10.0', 'color: #3b82f6; font-size: 24px; font-weight: bold;');
console.log('%cWelcome, hacker. Search for "lemon" 5 times to unlock secrets.', 'color: #f59e0b; font-size: 12px;');
console.log('%cType idkfa in search for God Mode.', 'color: #ef4444; font-size: 12px;');

// ===== INITIALIZATION =====
function initSystems() {
    initGames();
    initAchievements();
    initMatrix();
    loadState();
    
    // Check if coming from lockdown
    if (state.shutdownActive) {
        document.getElementById('aurelioStatus').textContent = 'LOCKDOWN';
        document.getElementById('aurelioStatus').style.color = 'var(--error-red)';
    }
}

// Start
initBoot();
</script>

</body>
</html>
